<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> -->
    <title>Document</title>
</head>
<body>
    <form>
        <input type="textarea" id="_textarea1" onfocus="registerthis(this.id)">

        <input type="textarea" id="_textarea2" onfocus="registerthis(this.id)">
    </form>

    <indic-text-input></indic-text-input>
    <script type="text/javascript">
        var shadowRoot
        var textInputToUse = null

        class IndicTextInput extends HTMLElement {
            constructor() {
                super()

                this.attachShadow({mode: 'open'})
                shadowRoot = this.shadowRoot
                const char_map = {
                    0: {'a': 'disabled', 'ā': '_a', 'i': 'disabled', 'ī': '_i', 'u': 'disabled'},
                    1: {'ū': '_u', 'r̥': '_r', 'e': 'disabled', 'ē': '_e', 'ai': 'disabled'},
                    2: {'o': 'disabled', 'ō': '_o', 'ou': 'disabled', 'ṁ': '_m', 'ḥ': '_h'},
                    3: {'k': 'disabled', 'kh': 'disabled', 'g': 'disabled', 'gh': 'disabled', 'ṅ': '_ng'},
                    4: {'c': 'disabled', 'ch': 'disabled', 'j': 'disabled', 'jh': 'disabled', 'ñ': '_ny'},
                    5: {'ṭ': '_t', 'ṭh': 'disabled', 'ḍ': '_d', 'ḍh': 'disabled', 'ṇ': '_N'},
                    6: {'t': 'disabled', 'th': 'disabled', 'd': 'disabled', 'dh': 'disabled', 'n': 'disabled'},
                    7: {'p': 'disabled', 'ph': 'disabled', 'b': 'disabled', 'bh': 'disabled', 'm': 'disabled'},
                    8: {'ṟ': '_R', 'ḷ': '_l', 'ḻ': '_L', 'ś': '_sh', 'ṣ': '_Sh'}
                }

                const table = document.createElement("table")
                for(var key in char_map) {
                    const row = document.createElement("tr")
                    table.appendChild(row)
                    for(var elem in char_map[key]) {
                        const cell = document.createElement("td")
                        if(char_map[key][elem] == 'disabled') {
                            cell.innerHTML = "<input type='button' value='" + elem +"' disabled>"
                        }
                        else {
                            cell.innerHTML = "<input type='button' value='" + elem + "' id='" + char_map[key][elem] + "' onclick=\"insertCharacterInto(this.id)\">"
                        }
                        row.appendChild(cell)
                    } 
                }

                this.shadowRoot.append(table);
                // this.hidden = true
            }
        }
        customElements.define("indic-text-input", IndicTextInput)

        function insertCharacterInto(characterId) {
            console.log(characterId, textInputToUse)
            var charToInsert = shadowRoot.getElementById(characterId).value;
            var curPos = document.getElementById(textInputToUse).selectionStart;
            var text = document.getElementById(textInputToUse).value;
            document.getElementById(textInputToUse).value = text.slice(0, curPos) + charToInsert + text.slice(curPos);
        }

        function registerthis(inputId) {
            textInputToUse = inputId
        }
    </script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> -->
</body>
</html>